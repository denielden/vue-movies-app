/* **************************************************
*	Name: Vue Movies app
*	Author: Deniel Den
*	Author URI: https://www.linkedin.com/in/denielden
*	Source API: https://rapidapi.com/apidojo/api/imdb8/
*	Version: 1.0.1
************************************************** */
window.onload=(()=>{const e=document.querySelector("nav"),t=document.querySelectorAll("header, #toggleNav"),a=document.querySelectorAll(".login, .sidebar"),i=document.querySelector(".container"),s=document.querySelector("#goTop");function o(){window.matchMedia("(max-width: 800px)").matches?a.forEach(e=>t[1].insertAdjacentElement("beforeend",e)):(t[0].insertAdjacentElement("afterend",a[1]),t[0].insertAdjacentElement("beforeend",a[0]))}i.onscroll=(()=>{i.scrollTop>100?s.style.display="block":s.style.display="none"}),e.addEventListener("click",e=>"NAV"===e.target.nodeName?e.target.firstChild.classList.toggle("active"):null),o(),window.addEventListener("resize",o)});var app=new Vue({el:"#vue-container",data:{title:"Popular Movies",query:"",data:{noApi:[{id:"/title/tt11138512/",image:{url:"https://m.media-amazon.com/images/M/MV5BMDNkMTVlODUtNjBlMi00ZTUyLWI5OTItZTFjMjVlMTA5MTkzXkEyXkFqcGdeQXVyODk4OTc3MTY@._V1_.jpg"},title:"The Northman",titleType:"movie",year:2022},{id:"/title/tt11198330/",image:{url:"https://m.media-amazon.com/images/M/MV5BMTFmZjZjOWItOWY0NC00ZDA1LWFhN2ItMDI1ZGNmNGE2NGJmXkEyXkFqcGdeQXVyMTkxNjUyNQ@@._V1_.jpg"},title:"House of the Dragon",titleType:"tvSeries",year:2022},{id:"/title/tt13320622/",image:{url:"https://m.media-amazon.com/images/M/MV5BYzdkOWYwOTEtMDFiYS00MzYzLWI0MmMtNjE1ODcyNDJjMTFiXkEyXkFqcGdeQXVyMTEyMjM2NDc2._V1_.jpg"},title:"The Lost City",titleType:"movie",year:2022},{id:"/title/tt10919420/",image:{url:"https://m.media-amazon.com/images/M/MV5BYWE3MDVkN2EtNjQ5MS00ZDQ4LTliNzYtMjc2YWMzMDEwMTA3XkEyXkFqcGdeQXVyMTEzMTI1Mjk3._V1_.jpg"},title:"Squid Game",titleType:"tvSeries",year:2021},{id:"/title/tt10838180/",image:{url:"https://m.media-amazon.com/images/M/MV5BMGJkNDJlZWUtOGM1Ny00YjNkLThiM2QtY2ZjMzQxMTIxNWNmXkEyXkFqcGdeQXVyMDM2NDM2MQ@@._V1_.jpg"},title:"The Matrix Resurrections",titleType:"movie",year:2021},{id:"/title/tt1160419/",image:{url:"https://m.media-amazon.com/images/M/MV5BN2FjNmEyNWMtYzM0ZS00NjIyLTg5YzYtYThlMGVjNzE1OGViXkEyXkFqcGdeQXVyMTkxNjUyNQ@@._V1_.jpg"},title:"Dune",titleType:"movie",year:2021},{id:"/title/tt11083552/",image:{url:"https://m.media-amazon.com/images/M/MV5BNGVkOTlhOTktNjZiNS00NDg3LWIxMDAtZTY5Y2E0YjllN2IxXkEyXkFqcGdeQXVyMTkxNjUyNQ@@._V1_.jpg"},title:"Wrath of Man",titleType:"movie",year:2021},{id:"/title/tt5180504/",image:{url:"https://m.media-amazon.com/images/M/MV5BN2FiOWU4YzYtMzZiOS00MzcyLTlkOGEtOTgwZmEwMzAxMzA3XkEyXkFqcGdeQXVyMTkxNjUyNQ@@._V1_.jpg"},title:"The Witcher",titleType:"tvSeries",year:2019},{id:"/title/tt7949218/",image:{url:"https://m.media-amazon.com/images/M/MV5BM2JkM2Y5NTEtZWIwZS00ZTliLTk3MDMtNzY4MDNkNjg0NTkwXkEyXkFqcGdeQXVyMDM2NDM2MQ@@._V1_.jpg"},title:"See",titleType:"tvSeries",year:2019},{id:"/title/tt2306299/",image:{url:"https://m.media-amazon.com/images/M/MV5BODk4ZjU0NDUtYjdlOS00OTljLTgwZTUtYjkyZjk1NzExZGIzXkEyXkFqcGdeQXVyMDM2NDM2MQ@@._V1_.jpg"},title:"Vikings",titleType:"tvSeries",year:2013}],movies:[],initList:[],details:null,saved:JSON.parse(window.localStorage.getItem("savedMovies"))||[]},orderBy:"date90",showModal:!1},methods:{toggleMode:()=>document.body.classList.toggle("light"),callAPI(e,t="find?q="){fetch("https://imdb8.p.rapidapi.com/title/"+t+e,{method:"GET",headers:{"x-rapidapi-host":"imdb8.p.rapidapi.com","x-rapidapi-key":"0905135359msh51384c9a3ea8141p160b7bjsnd25333f44851"}}).then(e=>(429===e.status&&(alert("Failed to recover data:\nAPI call limit exceeded.\n\nPlease try again at the end of the month!\nSorry for the inconvenience."),app.data.movies=app.data.noApi,app.data.initList=app.data.noApi),e.json())).catch(e=>console.error(e)).then(e=>{switch(t){case"get-most-popular-movies?homeCountry=IT&purchaseCountry=IT&currentCountry=IT":app.data.initList=e.slice(0,50);let a="";a=(a+=app.data.initList.map(e=>"&ids=tt"+app.clearIdMovie(e))).replaceAll(",","").substring(1),app.callAPI(a,"get-meta-data?");break;case"get-meta-data?":let i=[];Object.keys(e).forEach(t=>i.push(e[t].title)),app.filterUndefined(i),app.sortDecrescent(i),app.data.initList=i,app.data.movies=i;break;case"get-overview-details?tconst=":app.data.details=e;break;default:if(void 0===e.results)alert("No results found for: "+app.query),app.startMovie();else{let t=app.filterUndefined(e.results);app.sortDecrescent(t),app.data.movies=t}}})},init(){this.callAPI("","get-most-popular-movies?homeCountry=IT&purchaseCountry=IT&currentCountry=IT")},runQuery(){this.title=this.query,this.orderBy="date90",this.callAPI(this.query),this.scrollTopOn(),this.query=""},startMovie(){this.title="Popular Movies",this.query="",this.orderBy="date90",this.data.movies=this.data.initList,document.querySelector("#toggleNav").classList.remove("active"),this.scrollTopOn()},getDetails(e){let t=e.target.id;this.callAPI("tt"+t,"get-overview-details?tconst="),this.showModal=!0},orderByVal(e){switch(e.target.value){case"nameAZ":this.data.movies.sort((e,t)=>e.title.localeCompare(t.title));break;case"nameZA":this.data.movies.sort((e,t)=>t.title.localeCompare(e.title));break;case"date09":this.data.movies.sort((e,t)=>e.year-t.year);break;default:this.sortDecrescent(this.data.movies)}},saveMovie(e){const t=e.target.id,a=this.data.movies.filter(e=>e.id==="/title/tt"+t+"/");this.scrollTopOn(e,"ul#saved"),this.data.saved=[...a,...this.data.saved].filter((e,t,a)=>t===a.findIndex(t=>t.id===e.id)),this.saveMoviesToLocalStorage(),e.target.textContent="❤️ Saved",e.target.disabled=!0},removeSavedMovie(e){const t=e.target.dataset.id;this.data.saved=this.data.saved.filter(e=>e.id!=="/title/tt"+t+"/"),this.saveMoviesToLocalStorage();const a=document.getElementById(t);a&&"Saved Movies"!==this.title&&(a.removeAttribute("disabled"),a.textContent="Save Movie")},saveMoviesToLocalStorage(){localStorage.setItem("savedMovies",JSON.stringify(this.data.saved))},seeAllSaved(){this.title="Saved Movies",this.query="",this.orderBy="date90",this.data.movies=this.sortDecrescent(this.data.saved),document.querySelector("#toggleNav").classList.remove("active"),this.scrollTopOn()},filterUndefined:e=>e.filter(e=>null!=e.title&&e.image&&null!=e.image.url),sortDecrescent:e=>e.sort((e,t)=>t.year-e.year),clearIdMovie:e=>e.replace(/\D/g,""),reverseDate:e=>e.split("-").reverse().join("-"),scrollTopOn:(e,t=".container")=>document.querySelector(t).scrollTo({top:0,behavior:"smooth"})}});app.init();