/* **************************************************
*	Name: Vue Movies app
*	Author: Deniel Den
*	Author URI: https://www.linkedin.com/in/denielden
*	Source API: https://rapidapi.com/apidojo/api/imdb8/
*	Version: 1.0.0
************************************************** */
window.onload=(()=>{const e=document.querySelector("nav"),t=document.querySelectorAll("header, #toggleNav"),a=document.querySelectorAll(".login, .sidebar"),i=document.querySelector(".container"),r=document.querySelector("#goTop");function o(){window.matchMedia("(max-width: 800px)").matches?a.forEach(e=>t[1].insertAdjacentElement("beforeend",e)):(t[0].insertAdjacentElement("afterend",a[1]),t[0].insertAdjacentElement("beforeend",a[0]))}i.onscroll=(()=>{i.scrollTop>100?r.style.display="block":r.style.display="none"}),e.addEventListener("click",e=>"NAV"===e.target.nodeName?e.target.firstChild.classList.toggle("active"):null),o(),window.addEventListener("resize",o)});var app=new Vue({el:"#vue-container",data:{query:"",data:{noApi:[{id:"/title/ff4123432/",image:{url:"https://m.media-amazon.com/images/M/MV5BOTNjNWRjZDUtYjU1OC00NGFmLWE2ZDktMzhhYmIwOTU4YjVmXkEyXkFqcGdeQXVyMTEyMjM2NDc2._V1_.jpg"},title:"Fantastic Beasts: The Secrets of Dumbledore",titleType:"movie",year:2022},{id:"/title/ff10838180/",image:{url:"https://m.media-amazon.com/images/M/MV5BMGJkNDJlZWUtOGM1Ny00YjNkLThiM2QtY2ZjMzQxMTIxNWNmXkEyXkFqcGdeQXVyMDM2NDM2MQ@@._V1_.jpg"},title:"The Matrix Resurrections",titleType:"movie",year:2021},{id:"/title/ff1160419/",image:{url:"https://m.media-amazon.com/images/M/MV5BN2FjNmEyNWMtYzM0ZS00NjIyLTg5YzYtYThlMGVjNzE1OGViXkEyXkFqcGdeQXVyMTkxNjUyNQ@@._V1_.jpg"},title:"Dune",titleType:"movie",year:2021},{id:"/title/ff11083552/",image:{url:"https://m.media-amazon.com/images/M/MV5BNGVkOTlhOTktNjZiNS00NDg3LWIxMDAtZTY5Y2E0YjllN2IxXkEyXkFqcGdeQXVyMTkxNjUyNQ@@._V1_.jpg"},title:"Wrath of Man",titleType:"movie",year:2021},{id:"/title/ff5180504/",image:{url:"https://m.media-amazon.com/images/M/MV5BN2FiOWU4YzYtMzZiOS00MzcyLTlkOGEtOTgwZmEwMzAxMzA3XkEyXkFqcGdeQXVyMTkxNjUyNQ@@._V1_.jpg"},title:"The Witcher",titleType:"tvSeries",year:2019},{id:"/title/ff7949218/",image:{url:"https://m.media-amazon.com/images/M/MV5BM2JkM2Y5NTEtZWIwZS00ZTliLTk3MDMtNzY4MDNkNjg0NTkwXkEyXkFqcGdeQXVyMDM2NDM2MQ@@._V1_.jpg"},title:"See",titleType:"tvSeries",year:2019}],movies:[],initList:[],details:void 0},orderBy:"date90",saved:0},methods:{toggleMode(){document.body.classList.toggle("light")},fetchHelper(e,t="find?q="){fetch("https://imdb8.p.rapidapi.com/title/"+t+e,{method:"GET",headers:{"x-rapidapi-host":"imdb8.p.rapidapi.com","x-rapidapi-key":"0905135359msh51384c9a3ea8141p160b7bjsnd25333f44851"}}).then(e=>(429===e.status&&(alert("Failed to recover data:\nAPI call limit exceeded.\n\nPlease try again at the end of the month!\nSorry for the inconvenience."),app.data.movies=app.data.noApi,app.data.initList=app.data.noApi),e.json())).catch(e=>console.error(e)).then(e=>{switch(t){case"get-most-popular-movies?homeCountry=IT&purchaseCountry=IT&currentCountry=IT":app.data.initList=e.slice(0,50);let a="";a=(a=a.concat(app.data.initList.map(e=>"&ids=tt"+e.replace(/\D/g,"")))).replaceAll(",","").substring(1),this.fetchHelper(a,"get-meta-data?");break;case"get-meta-data?":let i=[];Object.keys(e).forEach(t=>i.push(e[t].title)),i=i.filter(e=>null!=e.title&&e.image&&null!=e.image.url),app.data.initList=i,app.data.movies=i;break;case"get-overview-details?tconst=":app.data.details=e;break;default:let r=e.results.filter(e=>null!=e.title&&e.image&&null!=e.image.url);this.sortDecrescent(r),app.data.movies=r}})},init(){this.query="",this.orderBy="date90",this.fetchHelper("","get-most-popular-movies?homeCountry=IT&purchaseCountry=IT&currentCountry=IT")},runQuery(){this.orderBy="date90",this.fetchHelper(this.query),this.scrollTopHelper()},startMovie(){this.orderBy="date90",app.data.movies=app.data.initList,document.querySelector("#toggleNav").classList.remove("active"),this.scrollTopHelper()},getDetails(e){let t=e.target.id;this.fetchHelper("tt"+t,"get-overview-details?tconst=")},saveMovie(e){e.target.textContent="❤️ Saved",e.target.disabled=!0;const t=document.querySelector("#saved"),a=e.target.value,i=e.target.id,r=document.createElement("li"),o=document.createElement("span"),l=document.createTextNode(a);o.setAttribute("id",i),o.onclick=this.removeSavedMovie,r.appendChild(o),r.appendChild(l),t.appendChild(r),this.saved=this.saved+1},removeSavedMovie(e){e.target.parentNode.remove();const t=document.getElementById(e.target.id);t.removeAttribute("disabled"),t.textContent="Save Movie",this.saved=this.saved-1},orderByVal(e){switch(e.target.value){case"nameAZ":this.data.movies.sort((e,t)=>e.title.localeCompare(t.title));break;case"nameZA":this.data.movies.sort((e,t)=>t.title.localeCompare(e.title));break;case"date09":this.data.movies.sort((e,t)=>e.year-t.year);break;default:this.sortDecrescent(this.data.movies)}},sortDecrescent:e=>e.sort((e,t)=>t.year-e.year),scrollTopHelper(){document.querySelector(".container").scrollTo({top:0,behavior:"smooth"})}}});app.init();